<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - RAN Articles Search</title>
</head>
<body>
    <h1>Debug Page</h1>
    <div id="debug-log"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    <script>
        async function testDataLoading() {
            const log = document.getElementById('debug-log');
            
            function addLog(message) {
                console.log(message);
                log.innerHTML += `<div>${message}</div>`;
            }
            
            addLog('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É articles.json
                addLog('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º articles.json...');
                const articlesResponse = await fetch(`data/articles.json?v=${Date.now()}`);
                addLog(`üì° articles.json —Å—Ç–∞—Ç—É—Å: ${articlesResponse.status}`);
                
                if (articlesResponse.ok) {
                    const articlesData = await articlesResponse.json();
                    addLog(`üìö –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç–∞—Ç–µ–π: ${articlesData.articles?.length || 0}`);
                    addLog(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${JSON.stringify(articlesData.stats)}`);
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ articles.json: ${articlesResponse.statusText}`);
                }
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É search-index.json
                addLog('üì• –ó–∞–≥—Ä—É–∂–∞–µ–º search-index.json...');
                const indexResponse = await fetch(`data/search-index.json?v=${Date.now()}`);
                addLog(`üì° search-index.json —Å—Ç–∞—Ç—É—Å: ${indexResponse.status}`);
                
                if (indexResponse.ok) {
                    const indexData = await indexResponse.json();
                    addLog(`üîç –§–æ—Ä–º–∞—Ç –∏–Ω–¥–µ–∫—Å–∞: version=${indexData.version}, fields=${indexData.fields?.length}, documents=${indexData.documents?.length}`);
                    
                    if (indexData.documents && indexData.documents.length > 0) {
                        addLog(`üìÑ –ü–µ—Ä–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç: ${JSON.stringify(indexData.documents[0], null, 2)}`);
                        
                        // –ü—Ä–æ–±—É–µ–º –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å
                        addLog('üîß –°—Ç—Ä–æ–∏–º Lunr.js –∏–Ω–¥–µ–∫—Å...');
                        const idx = lunr(function() {
                            this.ref('id');
                            this.field('title', { boost: 10 });
                            this.field('authors', { boost: 5 });
                            this.field('keywords', { boost: 8 });
                            this.field('abstract', { boost: 2 });
                            this.field('journal', { boost: 3 });
                            this.field('doi', { boost: 15 });
                            
                            indexData.documents.forEach((doc) => {
                                this.add(doc);
                            });
                        });
                        
                        addLog('‚úÖ –ò–Ω–¥–µ–∫—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                        
                        // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫
                        const results = idx.search('cancer');
                        addLog(`üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ "cancer": ${results.length} –Ω–∞–π–¥–µ–Ω–æ`);
                        
                    } else {
                        addLog('‚ùå –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ');
                    }
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ search-index.json: ${indexResponse.statusText}`);
                }
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                addLog(`‚ùå Stack: ${error.stack}`);
            }
        }
        
        testDataLoading();
    </script>
</body>
</html>