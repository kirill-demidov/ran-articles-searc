<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - RAN Articles Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
    </style>
</head>
<body>
    <h1>RAN Articles Search - Test Page</h1>
    <div id="results"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'log') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        async function testEverything() {
            log('üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'log');
            
            try {
                // –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ articles.json
                log('üì• –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ articles.json...', 'log');
                const articlesResponse = await fetch(`data/articles.json?t=${Date.now()}`);
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${articlesResponse.status} ${articlesResponse.statusText}`, 'log');
                
                if (!articlesResponse.ok) {
                    throw new Error(`HTTP ${articlesResponse.status}`);
                }
                
                const articlesData = await articlesResponse.json();
                log(`‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –°—Ç–∞—Ç–µ–π: ${articlesData.articles?.length || 0}`, 'success');
                log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${JSON.stringify(articlesData.stats, null, 2)}`, 'log');
                
                if (articlesData.articles && articlesData.articles.length > 0) {
                    log(`üîç –ü–µ—Ä–≤–∞—è —Å—Ç–∞—Ç—å—è: ${articlesData.articles[0].article?.title || 'No title'}`, 'log');
                }
                
                // –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ search-index.json
                log('üì• –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ search-index.json...', 'log');
                const indexResponse = await fetch(`data/search-index.json?t=${Date.now()}`);
                log(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${indexResponse.status} ${indexResponse.statusText}`, 'log');
                
                if (!indexResponse.ok) {
                    throw new Error(`HTTP ${indexResponse.status}`);
                }
                
                const indexData = await indexResponse.json();
                log(`‚úÖ –ò–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω! –í–µ—Ä—Å–∏—è: ${indexData.version}, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${indexData.documents?.length || 0}`, 'success');
                
                // –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ Lunr.js –∏–Ω–¥–µ–∫—Å–∞
                if (indexData.documents && indexData.documents.length > 0) {
                    log('üîß –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ Lunr.js –∏–Ω–¥–µ–∫—Å–∞...', 'log');
                    
                    const idx = lunr(function() {
                        this.ref('id');
                        this.field('title', { boost: 10 });
                        this.field('authors', { boost: 5 });
                        this.field('keywords', { boost: 8 });
                        this.field('abstract', { boost: 2 });
                        this.field('journal', { boost: 3 });
                        this.field('doi', { boost: 15 });
                        
                        indexData.documents.forEach((doc) => {
                            this.add(doc);
                        });
                    });
                    
                    log('‚úÖ Lunr.js –∏–Ω–¥–µ–∫—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!', 'success');
                    
                    // –¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
                    log('üîç –¢–µ—Å—Ç 4: –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤—É "cancer"...', 'log');
                    const searchResults = idx.search('cancer');
                    log(`üéØ –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${searchResults.length}`, searchResults.length > 0 ? 'success' : 'log');
                    
                    if (searchResults.length > 0) {
                        searchResults.slice(0, 3).forEach((result, i) => {
                            const doc = indexData.documents[parseInt(result.ref)];
                            log(`   ${i+1}. ${doc.title} (score: ${result.score.toFixed(3)})`, 'log');
                        });
                    }
                    
                    log('üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                    
                } else {
                    log('‚ùå –ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∏–Ω–¥–µ–∫—Å–µ', 'error');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`üìç Stack trace: ${error.stack}`, 'error');
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã
        testEverything();
    </script>
</body>
</html>